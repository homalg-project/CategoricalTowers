# SPDX-License-Identifier: GPL-2.0-or-later
# Algebroids: Algebroids and bialgebroids as preadditive categories generated by enhanced quivers
#
# Implementations
#
BindGlobal( "ADD_FUNCTIONS_FOR_QuotientCategory_LinearClosure_precompiled", function ( cat )
    
    ##
    AddDistinguishedObjectOfHomomorphismStructure( cat,
        
########
function ( cat_1 )
    return CreateCapCategoryObjectWithAttributes( RangeCategoryOfHomomorphismStructure( cat_1 ), RankOfObject, 1 );
end
########
        
    , 1 : IsPrecompiledDerivation := true );
    
    ##
    AddHomomorphismStructureOnObjects( cat,
        
########
function ( cat_1, arg2_1, arg3_1 )
    local deduped_1_1;
    deduped_1_1 := UnderlyingCategory( cat_1 );
    return CreateCapCategoryObjectWithAttributes( RangeCategoryOfHomomorphismStructure( cat_1 ), RankOfObject, Length( ExternalHoms( cat_1 )[ObjectIndex( ObjectDatum( deduped_1_1, UnderlyingCell( arg2_1 ) ) )][ObjectIndex( ObjectDatum( deduped_1_1, UnderlyingCell( arg3_1 ) ) )] ) );
end
########
        
    , 101 : IsPrecompiledDerivation := true );
    
    ##
    AddHomomorphismStructureOnMorphisms( cat,
        
########
function ( cat_1, alpha_1, beta_1 )
    local morphism_attr_1_1, hoisted_3_1, hoisted_4_1, hoisted_5_1, hoisted_6_1, hoisted_7_1, deduped_9_1, deduped_10_1, deduped_11_1, deduped_12_1, deduped_13_1, deduped_14_1, deduped_15_1, deduped_16_1;
    deduped_16_1 := CommutativeRingOfLinearCategory( cat_1 );
    deduped_15_1 := UnderlyingCategory( cat_1 );
    deduped_14_1 := ExternalHoms( cat_1 );
    deduped_13_1 := RangeCategoryOfHomomorphismStructure( cat_1 );
    deduped_12_1 := UnderlyingCell( Range( beta_1 ) );
    deduped_11_1 := UnderlyingCell( Source( alpha_1 ) );
    deduped_10_1 := deduped_14_1[ObjectIndex( ObjectDatum( deduped_15_1, deduped_11_1 ) )][ObjectIndex( ObjectDatum( deduped_15_1, deduped_12_1 ) )];
    deduped_9_1 := deduped_14_1[ObjectIndex( ObjectDatum( deduped_15_1, UnderlyingCell( Range( alpha_1 ) ) ) )][ObjectIndex( ObjectDatum( deduped_15_1, UnderlyingCell( Source( beta_1 ) ) ) )];
    hoisted_7_1 := ZeroImmutable( deduped_16_1 );
    hoisted_6_1 := GroebnerBasisOfDefiningRelations( cat_1 );
    hoisted_5_1 := IdentityMorphism( deduped_15_1, deduped_12_1 );
    hoisted_4_1 := UnderlyingCell( beta_1 );
    hoisted_3_1 := PreCompose( deduped_15_1, IdentityMorphism( deduped_15_1, deduped_11_1 ), UnderlyingCell( alpha_1 ) );
    morphism_attr_1_1 := HomalgMatrixListList( List( deduped_9_1, function ( ell_2 )
              local hoisted_1_2, hoisted_2_2, deduped_3_2;
              deduped_3_2 := ReductionOfMorphism( deduped_15_1, PreCompose( deduped_15_1, PreCompose( deduped_15_1, PreCompose( deduped_15_1, hoisted_3_1, UnderlyingCell( ell_2 ) ), hoisted_4_1 ), hoisted_5_1 ), hoisted_6_1 );
              hoisted_2_2 := CoefficientsList( deduped_3_2 );
              hoisted_1_2 := SupportMorphisms( deduped_3_2 );
              return List( deduped_10_1, function ( m_3 )
                      local deduped_1_3;
                      deduped_1_3 := Position( hoisted_1_2, SupportMorphisms( UnderlyingCell( m_3 ) )[1] );
                      if deduped_1_3 = fail then
                          return hoisted_7_1;
                      else
                          return hoisted_2_2[deduped_1_3];
                      fi;
                      return;
                  end );
          end ), Length( deduped_9_1 ), Length( deduped_10_1 ), deduped_16_1 );
    return CreateCapCategoryMorphismWithAttributes( deduped_13_1, CreateCapCategoryObjectWithAttributes( deduped_13_1, RankOfObject, NumberRows( morphism_attr_1_1 ) ), CreateCapCategoryObjectWithAttributes( deduped_13_1, RankOfObject, NumberColumns( morphism_attr_1_1 ) ), UnderlyingMatrix, morphism_attr_1_1 );
end
########
        
    , 1306 : IsPrecompiledDerivation := true );
    
    ##
    AddHomomorphismStructureOnMorphismsWithGivenObjects( cat,
        
########
function ( cat_1, source_1, alpha_1, beta_1, range_1 )
    local hoisted_2_1, hoisted_3_1, hoisted_4_1, hoisted_5_1, hoisted_6_1, hoisted_7_1, deduped_8_1, deduped_9_1, deduped_10_1, deduped_11_1, deduped_12_1;
    deduped_12_1 := CommutativeRingOfLinearCategory( cat_1 );
    deduped_11_1 := UnderlyingCategory( cat_1 );
    deduped_10_1 := ExternalHoms( cat_1 );
    deduped_9_1 := UnderlyingCell( Range( beta_1 ) );
    deduped_8_1 := UnderlyingCell( Source( alpha_1 ) );
    hoisted_7_1 := deduped_10_1[ObjectIndex( ObjectDatum( deduped_11_1, deduped_8_1 ) )][ObjectIndex( ObjectDatum( deduped_11_1, deduped_9_1 ) )];
    hoisted_6_1 := ZeroImmutable( deduped_12_1 );
    hoisted_5_1 := GroebnerBasisOfDefiningRelations( cat_1 );
    hoisted_4_1 := IdentityMorphism( deduped_11_1, deduped_9_1 );
    hoisted_3_1 := UnderlyingCell( beta_1 );
    hoisted_2_1 := PreCompose( deduped_11_1, IdentityMorphism( deduped_11_1, deduped_8_1 ), UnderlyingCell( alpha_1 ) );
    return CreateCapCategoryMorphismWithAttributes( RangeCategoryOfHomomorphismStructure( cat_1 ), source_1, range_1, UnderlyingMatrix, HomalgMatrixListList( List( deduped_10_1[ObjectIndex( ObjectDatum( deduped_11_1, UnderlyingCell( Range( alpha_1 ) ) ) )][ObjectIndex( ObjectDatum( deduped_11_1, UnderlyingCell( Source( beta_1 ) ) ) )], function ( ell_2 )
                local hoisted_1_2, hoisted_2_2, deduped_3_2;
                deduped_3_2 := ReductionOfMorphism( deduped_11_1, PreCompose( deduped_11_1, PreCompose( deduped_11_1, PreCompose( deduped_11_1, hoisted_2_1, UnderlyingCell( ell_2 ) ), hoisted_3_1 ), hoisted_4_1 ), hoisted_5_1 );
                hoisted_2_2 := CoefficientsList( deduped_3_2 );
                hoisted_1_2 := SupportMorphisms( deduped_3_2 );
                return List( hoisted_7_1, function ( m_3 )
                        local deduped_1_3;
                        deduped_1_3 := Position( hoisted_1_2, SupportMorphisms( UnderlyingCell( m_3 ) )[1] );
                        if deduped_1_3 = fail then
                            return hoisted_6_1;
                        else
                            return hoisted_2_2[deduped_1_3];
                        fi;
                        return;
                    end );
            end ), RankOfObject( source_1 ), RankOfObject( range_1 ), deduped_12_1 ) );
end
########
        
    , 1103 : IsPrecompiledDerivation := true );
    
    ##
    AddInterpretMorphismAsMorphismFromDistinguishedObjectToHomomorphismStructure( cat,
        
########
function ( cat_1, alpha_1 )
    local morphism_attr_1_1, hoisted_2_1, hoisted_3_1, hoisted_4_1, deduped_5_1, deduped_6_1, deduped_7_1, deduped_8_1, deduped_9_1;
    deduped_9_1 := CommutativeRingOfLinearCategory( cat_1 );
    deduped_8_1 := UnderlyingCategory( cat_1 );
    deduped_7_1 := RangeCategoryOfHomomorphismStructure( cat_1 );
    deduped_6_1 := ReductionOfMorphism( deduped_8_1, UnderlyingCell( alpha_1 ), GroebnerBasisOfDefiningRelations( cat_1 ) );
    deduped_5_1 := ExternalHoms( cat_1 )[ObjectIndex( ObjectDatum( deduped_8_1, UnderlyingCell( Source( alpha_1 ) ) ) )];
    hoisted_4_1 := CoefficientsList( deduped_6_1 );
    hoisted_3_1 := ZeroImmutable( deduped_9_1 );
    hoisted_2_1 := SupportMorphisms( deduped_6_1 );
    morphism_attr_1_1 := HomalgRowVector( List( deduped_5_1[ObjectIndex( ObjectDatum( deduped_8_1, UnderlyingCell( Target( alpha_1 ) ) ) )], function ( m_2 )
              local deduped_1_2;
              deduped_1_2 := Position( hoisted_2_1, SupportMorphisms( UnderlyingCell( m_2 ) )[1] );
              if deduped_1_2 = fail then
                  return hoisted_3_1;
              else
                  return hoisted_4_1[deduped_1_2];
              fi;
              return;
          end ), Length( deduped_5_1[ObjectIndex( ObjectDatum( deduped_8_1, UnderlyingCell( Range( alpha_1 ) ) ) )] ), deduped_9_1 );
    return CreateCapCategoryMorphismWithAttributes( deduped_7_1, CreateCapCategoryObjectWithAttributes( deduped_7_1, RankOfObject, 1 ), CreateCapCategoryObjectWithAttributes( deduped_7_1, RankOfObject, NumberColumns( morphism_attr_1_1 ) ), UnderlyingMatrix, morphism_attr_1_1 );
end
########
        
    , 204 : IsPrecompiledDerivation := true );
    
    ##
    AddInterpretMorphismFromDistinguishedObjectToHomomorphismStructureAsMorphism( cat,
        
########
function ( cat_1, source_1, range_1, alpha_1 )
    local deduped_2_1, deduped_3_1, deduped_4_1;
    deduped_4_1 := UnderlyingCell( range_1 );
    deduped_3_1 := UnderlyingCell( source_1 );
    deduped_2_1 := UnderlyingCategory( cat_1 );
    return CreateCapCategoryMorphismWithAttributes( cat_1, source_1, range_1, UnderlyingCell, Iterated( ListN( EntriesOfHomalgRowVector( UnderlyingMatrix( alpha_1 ) ), ExternalHoms( cat_1 )[ObjectIndex( ObjectDatum( deduped_2_1, deduped_3_1 ) )][ObjectIndex( ObjectDatum( deduped_2_1, deduped_4_1 ) )], function ( r_2, alpha_2 )
                return MultiplyWithElementOfCommutativeRingForMorphisms( deduped_2_1, r_2, UnderlyingCell( alpha_2 ) );
            end ), function ( alpha_2, beta_2 )
              return AdditionForMorphisms( deduped_2_1, alpha_2, beta_2 );
          end, ZeroMorphism( deduped_2_1, deduped_3_1, deduped_4_1 ) ) );
end
########
        
    , 603 : IsPrecompiledDerivation := true );
    
    if IsBound( cat!.precompiled_functions_added ) then
        
        # COVERAGE_IGNORE_NEXT_LINE
        Error( "precompiled functions have already been added before" );
        
    fi;
    
    cat!.precompiled_functions_added := true;
    
end );

BindGlobal( "QuotientCategory_LinearClosure_precompiled", function ( kF, rel )
  local category_constructor, cat;
    
    category_constructor :=
        
        
        function ( kF, rel )
    return QuotientCategory( kF, rel );
end;
        
        
    
    cat := category_constructor( kF, rel : FinalizeCategory := false, no_precompiled_code := true );
    
    ADD_FUNCTIONS_FOR_QuotientCategory_LinearClosure_precompiled( cat );
    
    Finalize( cat );
    
    return cat;
    
end );
